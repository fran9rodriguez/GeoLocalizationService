# GeoLocalizationService
Welcome to the GeoLocalizationService wiki!

# Description
This project is a webservice developed with WCF to expose rest services for geolocalization. The project is part of a small software which is also composed by a Google Maps user interface used to test this webservice. The code of the user interface can be downloaded [here](https://github.com/fran9rodriguez/GoogleMapsUI).

# Architecture
The WebService is composed by 4 parts. The Webservice interface (GeoLocalizationWS), a Business Layer (GeolocalizationBL), a Data Layer (GeoLocalizationDL) and a Cross Layer (GeoLocalizationCL). This Last Layer is used to connect with external services such as Loggly.com to register the exceptions and traces and to define the cross objects to use in the application. Finally, the project also contains an extract project for unit tests called GeolocalizaionUT

# Services
## SearchResults GetLocations(string Latitude, string Longitude, string maxDistance, string maxResults)
### Description
This service provides a json object with the results of a search of Locations. This search is carried out around a location (defined by Latitude and Longitude) in an area with a distance "maxDistance". The number of rows in the answer will be limited by "maxResults".

The service grab the data from an Excel file with CSV format which contains Locations information (address, latitude, longitude). The Data Layer implement an ExcelDL class to extract the data, but in case that you want to change the data source, you only need to do the following:

1. Change the key <add key="dataSource" value="CSV" /> web.config for a new value. for instance SQL
2. Implement the new class in the Data Layer which should inherit from IDataSource 
3. Update the method that you need in GeoData class

In order to decide which is the best way to grab a huge amount of rows from the excel file I've develop different methods with different approaches, and after comparison, I think the best way is to read the file with StreamReader and using Parallel Loop. The approaches have been the following:

1. getAllLocationsFileReaderLinq
2. getAllLocationsStream
3. getAllLocationsStreamParallel
4. GetLocationsLinqToExcel
5. GetLocationsOldbConnection
6. Async approach

After get the data, the business layer method "GeoQuerys.GetLocations" sort the list of locations and limit it to the max number of results using LINQ querys.

### Optimization
After several test for files of more than 1.000.000 the records the time for answer is about 2 seconds. This delay is due to the time needed to load the excel file, for this reason i've explored different optimization alternatives.

1. Cache
2. Async tasks.

### Testing

1. [Dowload the code](https://github.com/fran9rodriguez/GeoLocalizationService)
2. go to SearchService.svc in GeolocalizationWS
3. Compile and F5
4. http://localhost:63577/SearchService.svc/GetLocations/52.357596/4.916209/1000/100

### Output
`{"Distance":"1000","Error":"","FileRecords":506676,"Latitude":"52.357596","Locations":[{"Distance":0,"Latitude":52.357596,"Longitude":4.916209,"Name":"etos: 1e oosterparkstraat, amsterdam"},{"Distance":1.8210871603404304,"Latitude":52.3576018,"Longitude":4.9162341,"Name":"etos; eerste oosterparkstraat 204, amsterdam"},{"Distance":4.0643215082680051,"Latitude":52.3576232,"Longitude":4.916169,"Name":"etos; eerste oosterparkstraat 204, 1091hl, amsterdam"},{"Distance":4.1150035392772786,"Latitude":52.3576233,"Longitude":4.9161681,"Name":"etos; eerste oosterparkstraat 204, amsterdam"},{"Distance":4.40175689292605,"Latitude":52.3576348,"Longitude":4.9162218,"Name":"etos; eerste oosterparkstraat 204, amsterdam"},{"Distance":13.320104235228442,"Latitude":52.357712,"Longitude":4.91616,"Name":"etos; eerste oosterparkstraat 204, amsterdam"},{"Distance":20.193933119553375,"Latitude":52.3576388,"Longitude":4.916498,"Name":"run2day; �eerste oosterparkstraat 234,amsterdam, oosterpark"},{"Distance":27.704651801312249,"Latitude":52.3577228,"Longitude":4.9165602,"Name":"intertoys:  1ste oosterparkstraat 234, 1091 hm amsterdam"},{"Distance":91.429382882907888,"Latitude":52.3582082,"Longitude":4.91710787,"Name":"ab00943: 's-gravesandeplein, 10m na oosterpark (amsterdam)"},{"Distance":92.1747574517825,"Latitude":52.3574003,"Longitude":4.917528,"Name":"primera: beukenplein 6, 1091 kg amsterdam"},{"Distance":92.1826275288078,"Latitude":52.3574,"Longitude":4.917528,"Name":"primera; beukenplein 6 1091 kg amsterdam netherlands"},{"Distance":95.945198346283917,"Latitude":52.3574322,"Longitude":4.9175962,"Name":"primera postkantoor beukenplein; beukenplein 6, 1091 kg amsterdam"},{"Distance":95.965484431351669,"Latitude":52.3574266,"Longitude":4.9175947,"Name":"primera beukenplein; beukenplein 6, amsterdam"},{"Distance":98.188392410237512,"Latitude":52.3572818,"Longitude":4.9148577,"Name":"viv�nt goudsmit; eerste oosterparkstraat 172, 1091 hj amsterdam"},{"Distance":98.707876225730814,"Latitude":52.3572807,"Longitude":4.9148502,"Name":"viv�nt goudsmit: eerste oosterparkstraat 172, 1091 hj, amsterdam"},{"Distance":99.01234238345414,"Latitude":52.3583426,"Longitude":4.91700368,"Name":"ab00944: 20m na oosterpark, 's-gravesandeplein amsterdam"},{"Distance":135.07251946702493,"Latitude":52.35719647,"Longitude":4.91808742,"Name":"beukenplein, ab00945"},{"Distance":164.1171134717134,"Latitude":52.3571091,"Longitude":4.9139275,"Name":"eerste oosterparkstraat 152, amsterdam"},{"Distance":168.71981882371105,"Latitude":52.3570263,"Longitude":4.9139062,"Name":"dupon h.j.c. sigm.; eerste oosterparkstraat 152, 1091 hh amsterdam"},{"Distance":173.79138691484661,"Latitude":52.3565396,"Longitude":4.9143228,"Name":"eurest leisure (olvg); s-gravesandeplein 16 winkel, 1091 bc amsterdam"},{"Distance":193.76410919573482,"Latitude":52.35839223,"Longitude":4.91367086,"Name":"ab00975: ruyschstraat, 25m voor camperstraat (amsterdam)"},{"Distance":194.17386518720247,"Latitude":52.35830417,"Longitude":4.91359523,"Name":"ab00987: 15m na camperstraat, ruyschstraat amsterdam"},{"Distance":208.79236748079123,"Latitude":52.3581491,"Longitude":4.9132707,"Name":"bruna; camperstraat 36, amsterdam"},{"Distance":209.86717726469908,"Latitude":52.3581518,"Longitude":4.9132555,"Name":"bruna; camperstraat 36-38, amsterdam"},{"Distance":210.66175075269442,"Latitude":52.3581021,"Longitude":4.9132195,"Name":"bruna; camperstraat 36, 1091 ag amsterdam"},{"Distance":222.33348617745961,"Latitude":52.35959106,"Longitude":4.91642925,"Name":"mu00377: hoek  's-gravensandeplein, 's-gravesandestraat amsterdam"},{"Distance":222.98187940927241,"Latitude":52.35618265,"Longitude":4.91853851,"Name":"mu00398: beukenweg, 10m na vrolikstraat, amsterdam"},{"Distance":238.20657069685962,"Latitude":52.3570151,"Longitude":4.9128326,"Name":"jumper: 1ste oosterparkstraat 155, amsterdam"},{"Distance":239.51439083392819,"Latitude":52.3562736,"Longitude":4.9189932,"Name":"foto fransen: beukenweg 31, 1092 az amsterdam"},{"Distance":254.49624017033921,"Latitude":52.3568359,"Longitude":4.912674,"Name":"1e oosterparkstraat, amsterdam"},{"Distance":355.13894616159439,"Latitude":52.3589699,"Longitude":4.9209303,"Name":"appelsap"},{"Distance":383.6279790268415,"Latitude":52.3599575,"Longitude":4.9203278,"Name":"appelsap: oosterpark, 72, 1092 as watergraafsmeer, nederland"},{"Distance":390.71115358642521,"Latitude":52.35598,"Longitude":4.9111,"Name":"albert heijn; wibautstraat 80, amsterdam"},{"Distance":410.25810868883451,"Latitude":52.3547861,"Longitude":4.9201244,"Name":"moviemax oosterpark; krugerplein 1, 1092 jz amsterdam"},{"Distance":410.71692536840862,"Latitude":52.3547783,"Longitude":4.9201198,"Name":"moviemax oosterpark: krugerplein 1, 1092 jz, amsterdam"},{"Distance":413.10243710662837,"Latitude":52.3547442,"Longitude":4.920108,"Name":"ah; krugerplein 3 , amsterdam"},{"Distance":413.51553818622642,"Latitude":52.355889,"Longitude":4.910799,"Name":"albert heijn bv, wibautstraat, amsterdam, nederland"},{"Distance":413.66411960016023,"Latitude":52.3564394,"Longitude":4.9104193,"Name":"caf� k.h. de viersprong; eerste oosterparkstraat 105, amsterdam"},{"Distance":414.38980872649836,"Latitude":52.3547333,"Longitude":4.9201162,"Name":"albert heijn, krugerplein 3, 1092jz, amsterdam"},{"Distance":415.03910821803663,"Latitude":52.354649,"Longitude":4.91996,"Name":"albert heijn; krugerplein 3, amsterdam"},{"Distance":417.54062138082958,"Latitude":52.3547234,"Longitude":4.9201691,"Name":"ah; krugerplein 3, amsterdam"},{"Distance":417.86924666309079,"Latitude":52.35472,"Longitude":4.92017,"Name":"ah krugerplein 3, amsterdam"},{"Distance":421.40246371193996,"Latitude":52.3556903,"Longitude":4.9108451,"Name":"albert heijn; wibautstraat 80, amsterdam"},{"Distance":421.46187874756362,"Latitude":52.355863,"Longitude":4.9106893,"Name":"kantine  hogeschool van amsterdam loc. jan bommerhuis; wibautstraat 80, 1091 gp amsterdam"},{"Distance":422.10174082839967,"Latitude":52.3558617,"Longitude":4.9106798,"Name":"albert heijn: wibautstraat 80, amsterdam"},{"Distance":433.88725711975377,"Latitude":52.36018,"Longitude":4.911421,"Name":"hogeschool van amsterdam loc. koetsier-montaignehuis; mauritskade 11, amsterdam"},{"Distance":435.49857282493537,"Latitude":52.3601406,"Longitude":4.9113335,"Name":"hogeschool van amsterdam loc. koetsier-montaignehuis: mauritskade 11, 1091 gc amsterdam"},{"Distance":436.86284695193228,"Latitude":52.357266,"Longitude":4.9097985,"Name":"ruyschstraat 52 amsterdam"},{"Distance":437.60729496385665,"Latitude":52.36151904,"Longitude":4.91569279,"Name":"mu00378: mauritskade, 10m na 's gravensandestraat (amsterdam)"},{"Distance":445.01495394970038,"Latitude":52.35446392,"Longitude":4.92028871,"Name":"mu00389: krugerplein, 10m na pretoriustraat (amsterdam)"},{"Distance":450.4842372159593,"Latitude":52.35728462,"Longitude":4.9095948,"Name":"ab00986: ruyschstraat, 25m voor wibautstraat, amsterdam"},{"Distance":451.749643523109,"Latitude":52.35423791,"Longitude":4.91995349,"Name":"mu00388: 5m t\/o krugerplein, krugerplein amsterdam"},{"Distance":468.21162478732555,"Latitude":52.3572867,"Longitude":4.90933275,"Name":"ab04296: ruyschstraat, 30m na wibautstraat (amsterdam)"},{"Distance":483.2366388764338,"Latitude":52.3617709,"Longitude":4.9181865,"Name":"amstel lyceum; mauritskade 58, amsterdam"},{"Distance":522.910408210552,"Latitude":52.3598576,"Longitude":4.9094573,"Name":"kantine  hogeschool van amsterdam loc. singelgrachtgebouw; rhijnspoorplein 1, 1091 gc amsterdam"},{"Distance":523.02957643323214,"Latitude":52.3598518,"Longitude":4.9094501,"Name":"micaff� hva singelgracht: rhijnspoorplein 1, 1091 gc, amsterdam"},{"Distance":526.20181881098085,"Latitude":52.35926,"Longitude":4.9089548,"Name":"micaff�; wibautstraat 2, amsterdam"},{"Distance":538.2338523908021,"Latitude":52.3596992,"Longitude":4.90907,"Name":"micaff� hva kohnstammhuis: rhijnspoorplein 2, 1091 gc, amsterdam"},{"Distance":540.1228554375358,"Latitude":52.359312,"Longitude":4.9087678,"Name":"micaff�; rhijnspoorplein 2, amsterdam"},{"Distance":542.48978112611826,"Latitude":52.359749,"Longitude":4.90904,"Name":"micaff� hva singelgracht; rhijnspoorplein 1, amsterdam"},{"Distance":544.24239060045034,"Latitude":52.3592338,"Longitude":4.9086563,"Name":"hogeschool van amsterdam loc. kohnstammhuis; wibautstraat 2, amsterdam"},{"Distance":549.64963504550474,"Latitude":52.3597499,"Longitude":4.9089234,"Name":"micaff� hva singelgracht: rhijnspoorplein 1, 1091 gc amsterdam"},{"Distance":565.89847983444361,"Latitude":52.359878,"Longitude":4.90876,"Name":"micaff� hva kohnstammhuis; rhijnspoorplein 2, amsterdam"},{"Distance":570.09858890241151,"Latitude":52.3620927,"Longitude":4.9121752,"Name":"ah; sarphatistraat 141 , amsterdam"},{"Distance":573.664213446783,"Latitude":52.362041,"Longitude":4.91192,"Name":"albert heijn; sarphatistraat 141, amsterdam"},{"Distance":580.66141155218907,"Latitude":52.3621825,"Longitude":4.9121199,"Name":"nederland amsterdam - sarphatistraat 141"},{"Distance":580.68089653879338,"Latitude":52.3621825,"Longitude":4.9121193,"Name":"albert heijn; sarphatistr 141, 1018 gd, amsterdam"},{"Distance":582.97837367035356,"Latitude":52.3595886,"Longitude":4.92415,"Name":"willem witsenhuis; oosterpark 82, 1092 av, amsterdam"},{"Distance":588.99075429274774,"Latitude":52.36251,"Longitude":4.91297,"Name":"ah; sarphatistraat 141k, amsterdam"},{"Distance":589.49479667116054,"Latitude":52.3625141,"Longitude":4.9129668,"Name":"albert heijn; sarphatistraat 141k, amsterdam"},{"Distance":597.4527203233074,"Latitude":52.35301898,"Longitude":4.92081764,"Name":"ab04077: schalk burgerstraat, 10m voor transvaalstraat, amsterdam"},{"Distance":604.642015459905,"Latitude":52.362946,"Longitude":4.9178039,"Name":"voormalige cavaleriekazerne; sarphatistraat 470, amsterdam"},{"Distance":610.84159502005,"Latitude":52.3596755,"Longitude":4.92453514,"Name":"ab00939: oosterpark, 15m voor linnaeusstraat , amsterdam"},{"Distance":617.0467621181615,"Latitude":52.3630135,"Longitude":4.9142388,"Name":"universiteit van amsterdam; valckenierstraat 65, amsterdam"},{"Distance":624.66368361097261,"Latitude":52.360159,"Longitude":4.924395,"Name":"oosterpark amsterdam"},{"Distance":631.39634268331065,"Latitude":52.35974849,"Longitude":4.9248133,"Name":"ab00938: 10m voor linnaeusstraat, oosterpark amsterdam"},{"Distance":639.53934891529491,"Latitude":52.355783,"Longitude":4.9251466,"Name":"supermarkt helal et gida: pretoriusstraat 34, 1092 gh amsterdam"},{"Distance":642.26641418053543,"Latitude":52.36133579,"Longitude":4.90900053,"Name":"ab03942: sarphatistraat, 30m na wibautstraat (amsterdam)"},{"Distance":647.34314164148839,"Latitude":52.3610131,"Longitude":4.9084906,"Name":"convenience to go; metrostation weesperplein 1, 1018xa amsterdam"},{"Distance":648.22439209738764,"Latitude":52.3597591,"Longitude":4.9073444,"Name":"amstelhaven: mauritskade 1, 1091 ew amsterdam"},{"Distance":650.59748943885518,"Latitude":52.36298294,"Longitude":4.91994947,"Name":"mu00393: mauritskade, alexanderplein (2m na brug) (amsterdam)"},{"Distance":652.80803676891492,"Latitude":52.360395,"Longitude":4.92465976,"Name":"ab03715: oosterpark, 30m voor oosterpark (amsterdam)"},{"Distance":653.79845181058761,"Latitude":52.35999189,"Longitude":4.92500161,"Name":"mu00383: linnaeusstraat, hoek oosterpark (amsterdam)"},{"Distance":657.68328048287412,"Latitude":52.3622627,"Longitude":4.9102578,"Name":"skek; valckenierstraat 45, amsterdam"},{"Distance":661.45793014927813,"Latitude":52.3592825,"Longitude":4.9255502,"Name":"bcc bv: linnaeusstraat 20, 1092 ck amsterdam"},{"Distance":680.49692298272669,"Latitude":52.3583212,"Longitude":4.9261595,"Name":"ah; linnaeusstraat 40, amsterdam"},{"Distance":680.52257425535845,"Latitude":52.3583211,"Longitude":4.9261599,"Name":"albert heijn; linnaeusstraat 40, amsterdam"},{"Distance":682.47807066598671,"Latitude":52.35972474,"Longitude":4.92563564,"Name":"ab00960: linnaeusstraat, 20m voor wijttenbachstraat (amsterdam)"},{"Distance":682.51758425994353,"Latitude":52.35986819,"Longitude":4.92554607,"Name":"linnaeusstraat, ab00990"},{"Distance":682.97752321559028,"Latitude":52.3581535,"Longitude":4.9262251,"Name":"albert heijn: linnaeusstraat 44, 1092 cl amsterdam"},{"Distance":683.87011824656861,"Latitude":52.3599741,"Longitude":4.9254967,"Name":"vivant; linnaeusstraat 77, amsterdam"},{"Distance":684.16126394514708,"Latitude":52.3599749,"Longitude":4.9255008,"Name":"techador aisha ma; linnaeusstraat 77, 1093 ek amsterdam"},{"Distance":684.8581217100791,"Latitude":52.3581549,"Longitude":4.9262527,"Name":"albert heijn; linnaeusstraat 44, amsterdam"},{"Distance":686.1963306241995,"Latitude":52.36014628,"Longitude":4.92541105,"Name":"ab00991: 10m linnaeusstraat, wijttenbachstraat amsterdam"},{"Distance":687.23876182731942,"Latitude":52.36346446,"Longitude":4.91938559,"Name":"sarphatistraat, ab00892"},{"Distance":687.57632862153287,"Latitude":52.3583745,"Longitude":4.9262538,"Name":"linnaeusstraat 40     , amsterdam"},{"Distance":688.17718435033737,"Latitude":52.3580588,"Longitude":4.9263148,"Name":"albert heijn; linnaeusstraat 40-44, amsterdam"},{"Distance":688.3590204369317,"Latitude":52.3583491,"Longitude":4.9262706,"Name":"nederland amsterdam - linnaeusstraat 40"},{"Distance":688.40216958550673,"Latitude":52.3583493,"Longitude":4.9262712,"Name":"albert heijn, linnaeusstraat 40, 1092cl, amsterdam"},{"Distance":688.67049501348868,"Latitude":52.3583507,"Longitude":4.9262749,"Name":"albert heijn; linnaeusstraat 40, amsterdam"}],"Longitude":"4.916209","ReadDataDuration":0,"TotalDuration":0.8120465,"maxResults":"100","te":"\/Date(1440888260446+0200)\/","ts":"\/Date(1440888259634+0200)\/"}`
